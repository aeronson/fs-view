<div class="main">
  <div class="file-block">
    <div class="file-input-block">
      <button mat-button (click)="selectFolder()">Select Folder</button>
      <input type="text" [(ngModel)]="selectedFolder" readonly>
    </div>
    <div class="file-list">
      <select [size]="60" [(ngModel)]="selectedIndex" *ngIf="files.length" (change)="loadVideo()">
        <option *ngFor="let f of files; let i = index" [value]="i">{{getFileName(f)}}</option>
      </select>
    </div>
  </div>
  <div class="video-block" [class.vertical]="isVertical" *ngIf="selectedFile">
    <div class="video-container-block" [class.loading]="!videoSrc" [class.zoom]="zoom">
      <!-- background image if used -->
      <!-- <div class="video-bg" [style.backgroundImage]="backgroundDataUrl ? 'url(' + backgroundDataUrl + ')' : 'none'"></div> -->
      <!-- Keep the video element in DOM and hide with [hidden] to avoid re-creating and flicker -->
      <video #videoRef [hidden]="!videoSrc" [src]="videoSrc || null" muted playsinline webkit-playsinline
        preload="metadata" (ended)="autoNext()" (loadeddata)="onLoadedData()"
        (loadedmetadata)="onLoadedMetadata()"></video>
    </div>
    <div class="video-controls-block">
      <div class="video-controls" role="group" aria-label="Playback controls">
        <button mat-raised-button color="primary" (click)="play()">Play</button>
        <button mat-raised-button color="primary" (click)="pause()">Pause</button>
        <button mat-button (click)="restart()">Restart</button>
        <button mat-button (click)="previous()">Previous</button>
        <button mat-button (click)="next()">Next</button>
        <button mat-button (click)="toggleFullscreen()">Fullscreen</button>
        <button mat-button (click)="toggleZoom()">{{zoom ? 'Unzoom' : 'Zoom'}}</button>
        <!-- Fixture badge removed (UI cleaned up) -->
        <input type="text" [(ngModel)]="connectionKey" placeholder="Handy Connection Key">
        <button mat-button (click)="connectToHandy()" [disabled]="connected">Connect Handy</button>
      </div>
      <input class="slider" *ngIf="videoDuration > 0" type="range" [min]="0" [max]="videoDuration" [step]="0.01"
        [(ngModel)]="currentTime" (input)="seekVideo()" />
      <div class="chart-block">
        <canvas #chartRef></canvas>
        <div class="chart-placeholder" *ngIf="!funscriptData">No funscript data</div>
      </div>
    </div>
  </div>
</div>